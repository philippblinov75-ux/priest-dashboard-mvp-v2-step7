<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Priest Dashboard — Приход</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 id="title">Приход</h1>
      <a href="index.html"><button class="ghost">Регистрация</button></a>
    </div>
    <div id="content" class="grid"></div>
  </div>
  <script>
    const KEY='pd.applications';
    const params = new URLSearchParams(location.search);
    const slug = params.get('slug');
    const $ = (s)=>document.querySelector(s);
    function load(){ try { return JSON.parse(localStorage.getItem(KEY)||'[]'); } catch(e){ return []; } }
    function tpl(app){
      return \`
        <div class="card">
          <div class="flex" style="justify-content:space-between">
            <div class="flex">
              \${app.avatarDataUrl ? '<img src="'+app.avatarDataUrl+'" style="width:72px;height:72px;border-radius:12px;object-fit:cover"/>' : ''}
              <div>
                <div style="font-size:20px;font-weight:700">\${app.parishName}</div>
                <div><small>\${app.priestName} — \${app.city}</small></div>
              </div>
            </div>
            \${app.churchDataUrl ? '<img src="'+app.churchDataUrl+'" style="width:160px;height:96px;border-radius:12px;object-fit:cover"/>' : ''}
          </div>
          <hr/>
          <div>\${app.description.replace(/\n/g,'<br/>')}</div>
          <hr/>
          <div class="flex">
            <button class="ghost" disabled>Расписание (скоро)</button>
            <button class="ghost" disabled>Донаты (скоро)</button>
            <button class="ghost" disabled>Аудио (скоро)</button>
          </div>
        </div>
      \`;
    }
    const apps = load();
    const app = apps.find(a=>a.slug===slug && a.status==='approved');
    if (!app){
      $('#title').textContent = 'Приход не найден или не одобрен';
      $('#content').innerHTML = '<small>Проверьте slug или статус модерации.</small>';
    } else {
      $('#title').textContent = app.parishName;
      $('#content').innerHTML = tpl(app);
      document.title = app.parishName + ' — Priest Dashboard';
    }
  </script>
</body>
</html>
