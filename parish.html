<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Priest Dashboard — Приход</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 id="title">Приход</h1>
      <a href="index.html"><button class="ghost">Регистрация</button></a>
    </div>
    <div id="content" class="grid"></div>
  </div>

  <script>
    const KEY='pd.applications';
    const $ = (s)=>document.querySelector(s);
    const params = new URLSearchParams(location.search);
    const slug = params.get('slug');

    function load(){
      try { return JSON.parse(localStorage.getItem(KEY)||'[]'); }
      catch(e){ console.warn('LS parse error', e); return []; }
    }

    function card(app){
      return `
        <div class="card">
          <div class="flex" style="justify-content:space-between">
            <div class="flex">
              ${app.avatarDataUrl ? '<img src="'+app.avatarDataUrl+'" style="width:72px;height:72px;border-radius:12px;object-fit:cover"/>' : ''}
              <div>
                <div style="font-size:20px;font-weight:700">${app.parishName}</div>
                <div><small>${app.priestName} — ${app.city}</small></div>
                <div><small>slug: ${app.slug} · статус: ${app.status}</small></div>
              </div>
            </div>
            ${app.churchDataUrl ? '<img src="'+app.churchDataUrl+'" style="width:160px;height:96px;border-radius:12px;object-fit:cover"/>' : ''}
          </div>
          <hr/>
          <div>${(app.description||'').replace(/\n/g,'<br/>')}</div>
        </div>
      `;
    }

    (function run(){
      const apps = load();
      const found = apps.find(a => a.slug === slug); // показываем по любому статусу
      if (!slug){
        $('#title').textContent = 'Нет параметра slug';
        $('#content').innerHTML = '<small>Откройте страницу из админки или добавьте ?slug=...</small>';
        return;
      }
      if (!found){
        const have = apps.map(a=>a.slug).join(', ') || '—';
        $('#title').textContent = 'Приход не найден';
        $('#content').innerHTML = '<small>Искомый slug: <b>'+slug+
          '</b>. Наличие в хранилище: '+have+'</small>';
        return;
      }
      document.title = found.parishName + ' — Priest Dashboard';
      $('#title').textContent = found.parishName;
      $('#content').innerHTML = card(found);
    })();
  </script>
</body>
</html>
